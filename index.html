<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <title>ラップタイマー</title>
  <style>/* (省略) スタイルはそのまま保持 */</style>
</head>
<body>
  <!-- (省略) HTML構造はそのまま -->
  <script>
    // ... 要素取得・初期化・設定処理はそのまま保持 ...

    const addWrap = () => {
      const now = new Date();
      const wrapEnd = now.getTime();
      const wrapStart = lastStartDate ? lastStartDate.getTime() : wrapEnd;

      let effectiveDuration = 0;
      let current = wrapStart;
      while (current < wrapEnd) {
        const currentDate = new Date(current);
        const hhmm = `${zeroPad(currentDate.getHours(), 2)}:${zeroPad(currentDate.getMinutes(), 2)}`;
        const blocked = blockedTimeRanges.some(([start, end]) => {
          if (start > end) return hhmm >= start || hhmm < end;
          return hhmm >= start && hhmm < end;
        });
        if (!blocked) effectiveDuration++;
        current += 1000;
      }

      const wrapStr = `${zeroPad(Math.floor(effectiveDuration / 60), 2)}分${zeroPad(effectiveDuration % 60, 2)}秒`;
      const startStr = `${zeroPad(new Date(wrapStart).getHours(),2)}:${zeroPad(new Date(wrapStart).getMinutes(),2)}`;
      const endStr = `${zeroPad(new Date(wrapEnd).getHours(),2)}:${zeroPad(new Date(wrapEnd).getMinutes(),2)}`;
      const text = `${wrapList.length+1}回目 ${startStr}～${endStr}　${wrapStr}`;

      const li = document.createElement("li");
      li.className = "wrap_item";
      li.textContent = text;
      if (effectiveDuration >= 1800) li.classList.add("over30");
      wrapListDom.appendChild(li);
      wrapList.push(text);

      endBtn.disabled = false;
      startTime = wrapEnd;
      lastStartDate = new Date(wrapEnd);
      pausedDuration = 0;
      passTime = 0;
    };

    // ... 他のコードはそのまま ...
  </script>
</body>
</html>
